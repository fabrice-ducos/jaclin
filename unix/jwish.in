#! /bin/sh
# Wrapper script to start up Tcl/Tk Wish 8.0 with tclBlend

# Do not edit this script unless it is called jwish.in.
# tclBlend/unix/configure takes jwish.in, substitutes the @xx@
# fields and creates jwish.

# Author:  Christopher Hylands
# Version: @(#)jwish.in	1.9 08/07/98
#
# Copyright (c) 1997-1998 The Regents of the University of California.
# 	All Rights Reserved.
#
# Permission is hereby granted, without written agreement and without
# license or royalty fees, to use, copy, modify, and distribute this
# software and its documentation for any purpose, provided that the
# above copyright notice and the following two paragraphs appear in all
# copies of this software.
# 
# IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY
# FOR DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES
# ARISING OUT OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF
# THE UNIVERSITY OF CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
# 
# THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
# INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE. THE SOFTWARE
# PROVIDED HEREUNDER IS ON AN "AS IS" BASIS, AND THE UNIVERSITY OF
# CALIFORNIA HAS NO OBLIGATION TO PROVIDE MAINTENANCE, SUPPORT, UPDATES,
# ENHANCEMENTS, OR MODIFICATIONS.
# 
# 						PT_COPYRIGHT_VERSION_2
# 						COPYRIGHTENDKEY

# The next two lines gets substituted by configure
prefix=@prefix@
LIB_INSTALL_DIR=@exec_prefix@/lib

# Location of your tclBlend distribution
TCLBLEND=$LIB_INSTALL_DIR/tclblend

# Location of the jwish.tcl script
JWISH_TCL=$TCLBLEND/jwish.tcl


#full path name of wish and tclsh
WISH80=@WISH80@
TCLSH80=@TCLSH80@


# You probably need not edit JAVADEFAULT, as this script
# will guess values for them.

# Location of your JDK.  If this script can't find 'javac', then we
# use the value of JAVADEDAULT.
JAVADEFAULT=@JAVA_DIR@

#################
# You probably don't want to edit below here

# Make sure we can find the tclBlend directory so that we can do
#   package require java
if [ ! -d $TCLBLEND ]; then
    echo "$0: TCLBLEND was set to $TCLBLEND, which does not exist."
    echo " Please edit the value of TCLBLEND in the $0 script"
	exit 3
fi

# Make sure we can find the jwish.tcl script.
if [ ! -f $JWISH_TCL ]; then
    if [ -z "$(TYCHO-)" ]; then
	JWISH_TCL=$TYCHO/lib/windows/jtclsh.tcl
    fi
    if [ ! -f $JWISH_TCL ]; then
	echo "$0: JWISH_TCL was set to $JWISH_TCL, which does not exist."
	echo " Please edit the value of JWISH_TCL in the $0 script"
	exit 3
    fi	
fi

JAVAHOME="@JAVA_DIR@"

# Check the value of JAVAHOME
if [ ! -d "$JAVAHOME" ]; then
    echo "$0: tclBlend was configured with '$JAVAHOME', which"
    echo " does not seem to exist"
    exit 3
fi

if [ ! -r "$JAVAHOME/lib/classes.zip" -a ! -r "$JAVAHOME/lib/tools.jar" ]; then
    echo "$0: \$JAVAHOME == $JAVAHOME, but"
    echo " $JAVAHOME/lib/classes.zip"
    echo " and $JAVAHOME/lib/tools.jar do not exist or are not readable."
    echo " Please set \$JAVAHOME to the directory that contains your"
    echo " Java distribution"
    exit 3
fi

# Determine which directory contains the libjava shared library.

JAVALIBTHREADDIR=""
# If you edit this, check out configure.in too.
case "`uname -s" in
    HP-UX) JAVALIBDIR=$JAVAHOME/lib/PA_RISC/green_threads
	JAVA_ARCH_LIB_CHK=libjava.sl
	;;
    IRIX) JAVALIBDIR=$JAVAHOME/lib/sgi/green_threads
	JAVA_ARCH_LIB_CHK=libjava.so
	;;
    Linux) JAVALIBDIR=$JAVAHOME/lib/linux/green_threads
	JAVA_ARCH_LIB_CHK=libjava.so
	;;
    SunOS) 
	# Note that lib/sparc/green_threads
	# will _not_ work with tclBlend under Solaris
        JAVALIBDIR=$JAVAHOME/lib/sparc/native_threads
	JAVA_ARCH_LIB_CHK=libjava.so
	if test ! -f $JAVALIBDIR/$JAVA_ARCH_LIB_CHK; then
		# Could be JDK1.2beta4
		JAVALIBDIR=$JAVAHOME/jre/lib/sparc
		JAVALIBTHREADDIR=$JAVALIBDIR/native_threads 
		if [ ! -d $JAVALIBTHREADDIR ]; then
	    echo "$0: $JAVALIBTHREADDIR does not exist or is not readable"
	    echo " To use tclBlend under Solaris, you must install JDK1.1.4 "
	    echo " and the native threads pack, along with a few OS patches"
	    echo " see http://www.javasoft.com/products/jdk/1.1/index.html"
		fi
        fi	
	;;
    *) echo "Sorry, $0 does not know about '`uname -s`' architecture"
	exit 4
	;;

esac

#  Check that the directory exists
if [ ! -d $JAVALIBDIR ]; then
    echo "$0: $JAVALIBDIR does not exist or is not readable"
    echo " To use tclBlend under Solaris, you must install JDK1.1.4 "
    echo " and the native threads pack, along with a few OS patches"
    echo " see http://www.javasoft.com/products/jdk/1.1/index.html"
fi

# Check that libjava exists
if [ ! -f $JAVALIBDIR/$JAVA_ARCH_LIB_CHK ]; then
    echo "'$JAVALIBDIR/$JAVA_ARCH_LIB_CHK' does not exist or is"
    echo " not readable"
    exit 3
fi 

# Start setting up LD_LIBRARY_PATH or SHLIB_PATH
TMP_LD_LIBRARY_PATH="${LIB_INSTALL_DIR}:${TCLBLEND}:${JAVALIBDIR}"
if [ "$JAVALIBTHREADDIR" != "" ]; then
    TMP_LD_LIBRARY_PATH=${TMP_LD_LIBRARY_PATH}:${JAVALIBTHREADDIR}
fi

if [ "`arch -s`" = "HP-UX" ]; then
    SHLIB_PATH=${SHLIB_PATH}:${TMP_LD_LIBRARY_PATH}
    # Export these variables so the wish process can get at them. 
    export SHLIB_PATH CLASSPATH
else
    LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${TMP_LD_LIBRARY_PATH}

    # THREADS_FLAG tells java to use native threads, see README.ntp
    # in the native threads distribution.
    THREADS_FLAG=native

    # Export these variables so the wish process can get at them. 
    export LD_LIBRARY_PATH CLASSPATH THREADS_FLAG
fi

#set the TCLLIBPATH so that Tcl knows where to look for a "package require java"
if test "$TCLLIBPATH" = ""; then
    TCLLIBPATH="${LIB_INSTALL_DIR}"
else
    TCLLIBPATH="${TCLLIBPATH} ${LIB_INSTALL_DIR}"
fi
export TCLLIBPATH


# If this was called as jtclsh, then use tclsh8.0, otherwise, use wish8.0
PROG=`basename $0`
if [ "$PROG" = "jtclsh" ]; then
    WISH_OR_TCLSH=$TCLSH80
else
    WISH_OR_TCLSH=$WISH80
fi

# The jwish.tcl script takes the location of the tclBlend directory
# as an argument.
exec $WISH_OR_TCLSH $JWISH_TCL $TCLBLEND ${1+"$@"}
